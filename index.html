<script>
function abrirVideo(item){
  const videoModal = document.createElement('div');
  videoModal.style.position='fixed';
  videoModal.style.top='0'; videoModal.style.left='0';
  videoModal.style.width='100%'; videoModal.style.height='100%';
  videoModal.style.background='rgba(0,0,0,0.9)';
  videoModal.style.display='flex'; videoModal.style.justifyContent='center'; videoModal.style.alignItems='center';
  videoModal.style.zIndex='10000';

  const videoEl = document.createElement('video');
  videoEl.src = item.link;
  videoEl.controls = true;
  videoEl.style.width='80%';
  videoEl.style.height='80%';

  // Retomar do progresso salvo
  if(progresso[item.titulo]) videoEl.currentTime = progresso[item.titulo];

  let terminou = false;

  // Quando o vídeo terminar
  videoEl.onended = () => {
      terminou = true;
      // salva o progresso como o final do vídeo
      progresso[item.titulo] = videoEl.duration;
      salvarProgresso();
      mostrarSecao('inicio'); // atualiza a fila imediatamente
  };

  // Salvar progresso em tempo real apenas se não terminou
  videoEl.ontimeupdate = () => {
      if(!terminou) progresso[item.titulo] = videoEl.currentTime;
  };

  const fecharBtn = document.createElement('button');
  fecharBtn.textContent = 'Fechar';
  fecharBtn.style.position='absolute';
  fecharBtn.style.top='20px';
  fecharBtn.style.right='20px';
  fecharBtn.style.padding='10px 20px';
  fecharBtn.style.cursor='pointer';
  fecharBtn.onclick = () => {
      salvarProgresso(); // sempre salva ao fechar
      mostrarSecao('inicio'); // atualiza a fila
      videoModal.remove();
  };

  videoModal.appendChild(videoEl);
  videoModal.appendChild(fecharBtn);
  document.body.appendChild(videoModal);

  videoEl.play();
}
</script>
